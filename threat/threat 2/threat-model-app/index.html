<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Threat-Canvas â€” OWASP Threat Modeler</title>
  <link rel="stylesheet" href="main.css">
</head>

<body>
  <header>
    <div class="logo">
      <div class="logo-icon">ğŸ›¡</div>Threat-<span>Canvas</span>
    </div>
    <div class="step-tabs">
      <div class="step-tab active" id="stab1"><span class="step-num">1</span> Scope</div>
      <div class="step-tab" id="stab2"><span class="step-num">2</span> Threats / DFD</div>
      <div class="step-tab" id="stab3"><span class="step-num">3</span> Countermeasures</div>
      <div class="step-tab" id="stab4"><span class="step-num">4</span> Assess</div>
      <div class="step-tab" id="stab5"><span class="step-num">5</span> Cloud Sync</div>
    </div>
    <div class="hdr-actions">
      <button class="btn btn-ghost btn-sm" id="exampleBtn">Load Example</button>
      <div style="width:1px;height:16px;background:var(--border)"></div>
      <button class="btn btn-save btn-sm" title="Download full project as JSON">ğŸ’¾ Save Project</button>
      <button class="btn btn-ghost btn-sm" id="loadBtn" title="Restore project from JSON">ğŸ“‚ Load Project</button>
      <input type="file" id="loadInput" accept=".json,application/json" style="display:none">
      <div style="width:1px;height:16px;background:var(--border)"></div>
      <button class="btn btn-ghost btn-sm" id="openRulesBtn" title="Custom threat rules engine">âš™ Rules Engine</button>
      <button class="btn btn-primary btn-sm" id="exportBtn">â¬‡ Export Report</button>
    </div>
  </header>

  <div class="main">

    <!-- â”€â”€â”€ STEP 1: SCOPE â”€â”€â”€ -->
    <div class="step-panel active" id="panel1">
      <div class="scope-layout">
        <div class="scope-sidebar">
          <div
            style="padding:11px 14px;border-bottom:1px solid var(--border);font-size:10px;font-weight:800;letter-spacing:1.5px;color:var(--text3)">
            STEP 1 â€” SCOPE</div>
          <div class="scope-nav-item anav" data-sec="info">
            <div class="scope-nav-num">1</div>Project Info
          </div>
          <div class="scope-nav-item" data-sec="deps">
            <div class="scope-nav-num">2</div>External Dependencies
          </div>
          <div class="scope-nav-item" data-sec="entry">
            <div class="scope-nav-num">3</div>Entry Points
          </div>
          <div class="scope-nav-item" data-sec="exit">
            <div class="scope-nav-num">4</div>Exit Points
          </div>
          <div class="scope-nav-item" data-sec="assets">
            <div class="scope-nav-num">5</div>Assets
          </div>
          <div class="scope-nav-item" data-sec="trust">
            <div class="scope-nav-num">6</div>Trust Levels
          </div>
          <div style="padding:12px;margin-top:auto;border-top:1px solid var(--border);">
            <button class="btn btn-primary" style="width:100%" id="nextDfdBtn">Next: Build DFD â†’</button>
          </div>
        </div>
        <div class="scope-main">
          <!-- Project Info -->
          <div class="scope-section asec" id="sec-info">
            <div class="sec-card">
              <div class="sec-hdr">
                <div class="sec-title">ğŸ“‹ Threat Model Information</div>
              </div>
              <div class="sec-body">
                <div class="frow">
                  <div class="fg"><label class="lbl">Application Name</label><input class="inp" id="appName"
                      placeholder="e.g. College Library Website"></div>
                  <div class="fg"><label class="lbl">Version</label><input class="inp" id="appVersion"
                      placeholder="e.g. 1.0"></div>
                </div>
                <div class="fg"><label class="lbl">Description</label><textarea class="inp" id="appDesc"
                    placeholder="High-level description of the application and its purpose..."></textarea></div>
                <div class="frow">
                  <div class="fg"><label class="lbl">Document Owner</label><input class="inp" id="docOwner"
                      placeholder="e.g. David Lowry"></div>
                  <div class="fg"><label class="lbl">Participants</label><input class="inp" id="docParticipants"
                      placeholder="e.g. David Rook"></div>
                </div>
                <div class="frow">
                  <div class="fg"><label class="lbl">Reviewer</label><input class="inp" id="docReviewer"
                      placeholder="e.g. Eoin Keary"></div>
                  <div class="fg"><label class="lbl">Date</label><input class="inp" id="docDate" type="date"></div>
                </div>
              </div>
            </div>
          </div>
          <!-- External Dependencies -->
          <div class="scope-section" id="sec-deps">
            <div class="sec-card">
              <div class="sec-hdr">
                <div class="sec-title">ğŸ”— External Dependencies</div><span
                  style="font-size:11px;color:var(--text2)">Items outside codebase that may pose threats</span>
              </div>
              <div class="sec-body">
                <table class="dtable">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Description</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody id="depsTbody"></tbody>
                </table>
                <button class="add-btn" data-add-row="deps">+ Add External Dependency</button>
              </div>
            </div>
          </div>
          <!-- Entry Points -->
          <div class="scope-section" id="sec-entry">
            <div class="sec-card">
              <div class="sec-hdr">
                <div class="sec-title">ğŸšª Entry Points</div><span style="font-size:11px;color:var(--text2)">Where
                  attackers interact with the system</span>
              </div>
              <div class="sec-body">
                <table class="dtable">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Description</th>
                      <th>Trust Levels</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody id="entryTbody"></tbody>
                </table>
                <button class="add-btn" data-add-row="entry">+ Add Entry Point</button>
              </div>
            </div>
          </div>
          <!-- Exit Points -->
          <div class="scope-section" id="sec-exit">
            <div class="sec-card">
              <div class="sec-hdr">
                <div class="sec-title">ğŸšª Exit Points</div><span style="font-size:11px;color:var(--text2)">Where data
                  leaves the system (XSS, info disclosure)</span>
              </div>
              <div class="sec-body">
                <table class="dtable">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Description</th>
                      <th>Risk</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody id="exitTbody"></tbody>
                </table>
                <button class="add-btn" data-add-row="exit">+ Add Exit Point</button>
              </div>
            </div>
          </div>
          <!-- Assets -->
          <div class="scope-section" id="sec-assets">
            <div class="sec-card">
              <div class="sec-hdr">
                <div class="sec-title">ğŸ’ Assets</div><span style="font-size:11px;color:var(--text2)">Physical and
                  abstract items worth protecting</span>
              </div>
              <div class="sec-body">
                <table class="dtable">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Description</th>
                      <th>Required Trust Levels</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody id="assetsTbody"></tbody>
                </table>
                <button class="add-btn" data-add-row="assets">+ Add Asset</button>
              </div>
            </div>
          </div>
          <!-- Trust Levels -->
          <div class="scope-section" id="sec-trust">
            <div class="sec-card">
              <div class="sec-hdr">
                <div class="sec-title">ğŸ”‘ Trust Levels</div><span style="font-size:11px;color:var(--text2)">Access
                  rights granted to external entities</span>
              </div>
              <div class="sec-body">
                <table class="dtable">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Description</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody id="trustTbody"></tbody>
                </table>
                <button class="add-btn" data-add-row="trust">+ Add Trust Level</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- â”€â”€â”€ STEP 2: THREATS / DFD â”€â”€â”€ -->
    <div class="step-panel" id="panel2">
      <div class="threats-layout">
        <div class="palette">
          <div class="pal-sec">
            <div class="pal-lbl">External</div>
            <div class="pal-item" draggable="true" data-type="internet">
              <div class="pal-ico" style="background:rgba(255,107,107,.15)">ğŸŒ</div>Internet
            </div>
            <div class="pal-item" draggable="true" data-type="user">
              <div class="pal-ico" style="background:rgba(77,157,224,.15)">ğŸ‘¤</div>User
            </div>
            <div class="pal-item" draggable="true" data-type="attacker">
              <div class="pal-ico" style="background:rgba(255,68,68,.15)">â˜ ï¸</div>Attacker
            </div>
          </div>
          <div class="pal-sec">
            <div class="pal-lbl">Network</div>
            <div class="pal-item" draggable="true" data-type="firewall">
              <div class="pal-ico" style="background:rgba(255,140,0,.15)">ğŸ”¥</div>Firewall
            </div>
            <div class="pal-item" draggable="true" data-type="loadbalancer">
              <div class="pal-ico" style="background:rgba(245,158,11,.15)">âš–ï¸</div>Load Balancer
            </div>
            <div class="pal-item" draggable="true" data-type="vpn">
              <div class="pal-ico" style="background:rgba(77,157,224,.15)">ğŸ”’</div>VPN
            </div>
            <div class="pal-item" draggable="true" data-type="cdn">
              <div class="pal-ico" style="background:rgba(245,158,11,.15)">â˜ï¸</div>CDN
            </div>
          </div>
          <div class="pal-sec">
            <div class="pal-lbl">Compute</div>
            <div class="pal-item" draggable="true" data-type="webserver">
              <div class="pal-ico" style="background:rgba(0,102,255,.15)">ğŸ–¥</div>Web Server
            </div>
            <div class="pal-item" draggable="true" data-type="api">
              <div class="pal-ico" style="background:rgba(245,158,11,.15)">âš¡</div>API Server
            </div>
            <div class="pal-item" draggable="true" data-type="microservice">
              <div class="pal-ico" style="background:rgba(77,157,224,.15)">ğŸ”§</div>Microservice
            </div>
            <div class="pal-item" draggable="true" data-type="lambda">
              <div class="pal-ico" style="background:rgba(255,140,0,.15)">Î»</div>Serverless
            </div>
          </div>
          <div class="pal-sec">
            <div class="pal-lbl">Data</div>
            <div class="pal-item" draggable="true" data-type="database">
              <div class="pal-ico" style="background:rgba(255,107,107,.15)">ğŸ—„</div>Database
            </div>
            <div class="pal-item" draggable="true" data-type="cache">
              <div class="pal-ico" style="background:rgba(255,217,61,.15)">âš¡</div>Cache
            </div>
            <div class="pal-item" draggable="true" data-type="storage">
              <div class="pal-ico" style="background:rgba(245,158,11,.15)">ğŸ“¦</div>Storage
            </div>
            <div class="pal-item" draggable="true" data-type="messagequeue">
              <div class="pal-ico" style="background:rgba(77,157,224,.15)">ğŸ“¨</div>Msg Queue
            </div>
          </div>
          <div class="pal-sec">
            <div class="pal-lbl">Security</div>
            <div class="pal-item" draggable="true" data-type="waf">
              <div class="pal-ico" style="background:rgba(255,140,0,.15)">ğŸ›¡</div>WAF
            </div>
            <div class="pal-item" draggable="true" data-type="idp">
              <div class="pal-ico" style="background:rgba(245,158,11,.15)">ğŸ”‘</div>Identity Provider
            </div>
            <div class="pal-item" draggable="true" data-type="siem">
              <div class="pal-ico" style="background:rgba(255,68,68,.15)">ğŸ‘</div>SIEM
            </div>
          </div>
        </div>
        <div class="canvas-wrap" id="canvasWrap">
          <!-- #viewport is the single transform target for zoom + pan.
         Both the SVG edge layer and the node layer live inside it
         so all coordinates stay in the same space regardless of zoom. -->
          <div id="viewport">
            <svg id="svgLayer"></svg>
            <div id="canvas"></div>
          </div>

          <!-- Empty-hint lives outside #viewport so it always centres
         in the visible canvas-wrap area, not the 4000px virtual canvas -->
          <div class="empty-hint" id="emptyHint">
            <div style="font-size:42px;margin-bottom:14px;opacity:.2">ğŸ—</div>
            <h3>Build your Data Flow Diagram</h3>
            <p>Drag components from the left â€¢ Click ports to connect â€¢ Right-click an edge to edit/delete â€¢ Press <kbd
                style="background:var(--s2);border:1px solid var(--border);border-radius:3px;padding:1px 5px;font-size:11px">A</kbd>
              to analyze</p>
            <button class="btn btn-primary" style="margin-top:16px;font-size:12px" id="exampleBtnHint">â–¶ Load Example
              Architecture</button>
          </div>

          <!-- Zoom controls â€” bottom-right corner, always on top -->
          <div class="zoom-bar" id="zoomBar">
            <button class="zoom-btn" id="zoomOutBtn" title="Zoom out (-)">âˆ’</button>
            <span class="zoom-pct" id="zoomPct">100%</span>
            <button class="zoom-btn" id="zoomInBtn" title="Zoom in (+)">+</button>
            <div class="zoom-sep"></div>
            <button class="zoom-btn" id="zoomFitBtn" title="Fit all nodes in view">âŠ¡</button>
            <button class="zoom-btn" id="zoomResetBtn" title="Reset to 100%">1:1</button>
          </div>
        </div>
        <div class="rpanel" id="rpanel">
          <!-- â”€â”€ Mode toggle â”€â”€ -->
          <div style="display:flex;gap:6px;margin-bottom:12px">
            <button class="btn-mode" id="modeAnalyze" style="flex:1">ğŸ” Analyze</button>
            <button class="btn-mode" id="modeBlast" style="flex:1">ğŸ’¥ Blast Radius</button>
          </div>

          <!-- â”€â”€ Component Threat Profile (shown when node selected) â”€â”€ -->
          <div id="ctpSection" style="display:none"></div>

          <!-- â”€â”€ Edge Editor (shown when edge clicked) â”€â”€ -->
          <div id="edgeEditorSection" style="display:none"></div>

          <!-- â”€â”€ Blast radius info â”€â”€ -->
          <div id="blastInfo" style="display:none">
            <div class="blast-bar">
              <span class="blast-label">ğŸ’¥ BLAST RADIUS</span>
              <span id="blastCount" style="color:var(--text2)">Click a node to simulate compromise</span>
            </div>
          </div>

          <!-- â”€â”€ Analyze mode content â”€â”€ -->
          <div id="analyzeContent">
            <!-- Mode tabs: Threats vs Attack Paths -->
            <div class="mode-bar">
              <div class="mode-tab active" id="rpTab-threats">ğŸ” Threats</div>
              <div class="mode-tab" id="rpTab-paths">âš”ï¸ Attack Paths <span id="apTabBadge"
                  style="background:rgba(239,68,68,.2);color:#ef4444;border-radius:10px;padding:0 5px;font-size:9px;font-family:'JetBrains Mono',monospace">0</span>
              </div>
            </div>

            <!-- Threats sub-panel -->
            <div id="rpPanel-threats">
              <div id="detectedThreats" style="margin-bottom:10px">
                <div style="text-align:center;color:var(--text3);padding:24px 0;font-size:12px">Build DFD then press
                  Analyze</div>
              </div>
            </div>

            <!-- Attack Paths sub-panel -->
            <div id="rpPanel-paths" style="display:none">
              <div id="attackPathsContainer">
                <div style="text-align:center;color:var(--text3);padding:24px 0;font-size:12px">Run analysis to detect
                  attack paths</div>
              </div>
              <button class="btn btn-ghost" style="width:100%;font-size:11px;margin-top:8px" id="clearHighlightsBtn">âœ•
                Clear Highlights</button>
            </div>

            <button class="btn btn-primary" style="width:100%;margin-bottom:7px;margin-top:6px" id="analyzeBtn">â–¶
              Analyze Architecture</button>
            <button class="btn btn-ghost" style="width:100%;font-size:11px;margin-bottom:14px" id="clearBtn">Clear
              Canvas</button>
            <div class="rp-title">âš”ï¸ Attack Simulation</div>
            <button class="btn btn-ghost" style="width:100%;font-size:11px;margin-bottom:7px" id="simToggleBtn">â–¶ Start
              Traffic Sim</button>
            <div class="atk-btn" data-attack="sqli">ğŸ’‰ SQL Injection</div>
            <div class="atk-btn" data-attack="ddos">ğŸ’¥ DDoS Flood</div>
            <div class="atk-btn" data-attack="lateral">â†”ï¸ Lateral Movement</div>
            <div class="atk-btn" data-attack="exfil">ğŸ“¤ Data Exfiltration</div>
          </div>

          <!-- â”€â”€ Blast mode content â”€â”€ -->
          <div id="blastContent" style="display:none">
            <div style="font-size:11px;color:var(--text2);line-height:1.8;margin-bottom:12px">
              <strong style="color:var(--text)">Node colors:</strong><br>
              <span style="color:#ef4444">â– </span> Source (compromised)<br>
              <span style="color:#f97316">â– </span> Reachable (1 hop)<br>
              <span style="color:#facc15">â– </span> Reachable (2+ hops)<br>
              <span style="color:#a78bfa">â– </span> Reachable via priv-esc<br>
              <span style="color:var(--text3)">â– </span> Blocked / unreachable<br><br>
              <strong style="color:var(--text)">Edge colors:</strong><br>
              <span style="color:#ef4444">â€”â€”</span> Traversed blast path<br>
              <span style="color:#34d399">- -</span> ğŸ›¡ Blocked by auth+TLS<br>
              <span style="color:#34d399">- -</span> ğŸ”‘ Credential not scoped<br>
              <span style="color:#374151">Â·Â·</span> ğŸš§ No network route<br>
              <span style="color:#a78bfa">â€”â€”</span> â¬†ï¸ Privilege escalation<br><br>
              <strong style="color:var(--text)">Detection badges:</strong><br>
              <span style="background:#ef4444;color:#fff;padding:1px 4px;border-radius:2px;font-size:9px">low%</span>
              Low detection risk<br>
              <span style="background:#f97316;color:#fff;padding:1px 4px;border-radius:2px;font-size:9px">med%</span>
              Moderate risk<br>
              <span style="background:#34d399;color:#000;padding:1px 4px;border-radius:2px;font-size:9px">high%</span>
              Likely detected<br><br>
              <span style="color:var(--text3);font-size:10px;line-height:1.6">
                <strong style="color:var(--text2)">6 factors modeled:</strong><br>
                1. Auth strength + TLS version<br>
                2. Credential scope (shared vs vault)<br>
                3. Network zone + route existence<br>
                4. Compromise impact level<br>
                5. Detection probability (SIEM/WAF)<br>
                6. IAM privilege escalation paths
              </span>
            </div>
            <button class="btn btn-ghost" style="width:100%;font-size:11px" id="clearBlastBtn">âœ• Clear Blast
              Radius</button>

            <!-- âš ï¸ Professional disclaimer â€” detection % are model estimates, not measured values -->
            <div class="blast-disclaimer">
              <div class="blast-disclaimer-icon">âš ï¸</div>
              <div class="blast-disclaimer-text">
                <strong>Design-Time Model Only</strong><br>
                Detection probabilities and reachability scores model <em>theoretical</em> attack paths based on your
                architecture configuration. They are <strong>not</strong> measured against live infrastructure.<br><br>
                This is not a substitute for penetration testing or attack simulation tools (e.g. MITRE ATT&CK, Atomic
                Red Team, or professional red-team engagements).
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- â”€â”€â”€ STEP 3: COUNTERMEASURES â”€â”€â”€ -->
    <div class="step-panel" id="panel3">
      <div class="cm-layout">
        <div class="cm-main">
          <div style="font-size:14px;font-weight:800;margin-bottom:14px">STRIDE Threat Categories <span
              style="font-size:11px;font-weight:400;color:var(--text2)">â€” Click to filter</span></div>
          <div class="stride-grid" id="strideGrid">
            <div class="stride-card">
              <div class="stride-ico">ğŸ­</div>
              <div class="stride-name">Spoofing</div>
              <div class="stride-desc">Identity / credential abuse</div>
              <div class="stride-cnt" id="cS" style="color:#9b59b6">0</div>
            </div>
            <div class="stride-card">
              <div class="stride-ico">âœï¸</div>
              <div class="stride-name">Tampering</div>
              <div class="stride-desc">Malicious data modification</div>
              <div class="stride-cnt" id="cT" style="color:#e67e22">0</div>
            </div>
            <div class="stride-card">
              <div class="stride-ico">ğŸš«</div>
              <div class="stride-name">Repudiation</div>
              <div class="stride-desc">Untraceable operations</div>
              <div class="stride-cnt" id="cR" style="color:#3498db">0</div>
            </div>
            <div class="stride-card">
              <div class="stride-ico">ğŸ‘</div>
              <div class="stride-name">Info Disclosure</div>
              <div class="stride-desc">Unauthorized data access</div>
              <div class="stride-cnt" id="cI" style="color:#e74c3c">0</div>
            </div>
            <div class="stride-card">
              <div class="stride-ico">ğŸ’¥</div>
              <div class="stride-name">Denial of Service</div>
              <div class="stride-desc">Availability disruption</div>
              <div class="stride-cnt" id="cD" style="color:#2ecc71">0</div>
            </div>
            <div class="stride-card">
              <div class="stride-ico">â¬†ï¸</div>
              <div class="stride-name">Elevation of Privilege</div>
              <div class="stride-desc">Unauthorized privilege gain</div>
              <div class="stride-cnt" id="cE" style="color:#ff6b6b">0</div>
            </div>
          </div>
          <div class="sec-card">
            <div class="sec-card-hdr">
              <div class="sec-card-title">ğŸ“‹ Threat Countermeasure Register</div><span
                style="font-size:11px;color:var(--text2)">Set Accept / Eliminate / Mitigate / Transfer per threat</span>
            </div>
            <table class="dtable" id="cmTable">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Threat</th>
                  <th>STRIDE</th>
                  <th>Severity</th>
                  <th>Likelihood</th>
                  <th>Impact</th>
                  <th>Risk</th>
                  <th>Response</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="cmTbody">
                <tr>
                  <td colspan="9" style="text-align:center;color:var(--text3);padding:28px">Run analysis in Step 2 first
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="cm-sidebar">
          <div class="rp-title">ğŸ“– STRIDE â†’ Controls</div>
          <div style="font-size:11px;line-height:1.7;color:var(--text2)">
            <div style="margin-bottom:11px"><strong style="color:#9b59b6">ğŸ­ Spoofing â†’ Authentication</strong><br>â€¢
              Strong authentication<br>â€¢ Protect secret data<br>â€¢ Don't store secrets</div>
            <div style="margin-bottom:11px"><strong style="color:#e67e22">âœï¸ Tampering â†’ Integrity</strong><br>â€¢
              Authorization<br>â€¢ Hashes / MACs<br>â€¢ Digital signatures<br>â€¢ Tamper-resistant protocols</div>
            <div style="margin-bottom:11px"><strong style="color:#3498db">ğŸš« Repudiation â†’ Non-Repudiation</strong><br>â€¢
              Digital signatures<br>â€¢ Timestamps<br>â€¢ Audit trails</div>
            <div style="margin-bottom:11px"><strong style="color:#e74c3c">ğŸ‘ Info Disclosure â†’
                Confidentiality</strong><br>â€¢ Authorization<br>â€¢ Privacy-enhanced protocols<br>â€¢ Encryption<br>â€¢ Don't
              store secrets</div>
            <div style="margin-bottom:11px"><strong style="color:#2ecc71">ğŸ’¥ DoS â†’ Availability</strong><br>â€¢
              Authentication + AuthZ<br>â€¢ Filtering & throttling<br>â€¢ Quality of service</div>
            <div style="margin-bottom:11px"><strong style="color:#ff6b6b">â¬†ï¸ EoP â†’ Authorization</strong><br>â€¢ Least
              privilege<br>â€¢ RBAC enforcement<br>â€¢ Privilege separation</div>
          </div>
          <div style="border-top:1px solid var(--border);padding-top:12px;margin-top:6px">
            <div class="rp-title">ğŸ“Š Qualitative Risk Model</div>
            <div style="font-size:11px;color:var(--text2);line-height:1.7">
              <span style="color:var(--crit)">Critical</span> = High Ã— High<br>
              <span style="color:var(--high)">High</span> = High Ã— Med<br>
              <span style="color:var(--med)">Medium</span> = Med Ã— Med<br>
              <span style="color:var(--low)">Low</span> = Low Ã— Low
            </div>
          </div>
          <div style="border-top:1px solid var(--border);padding-top:12px;margin-top:10px">
            <div class="rp-title">ğŸ›¡ Response Options</div>
            <div style="font-size:11px;color:var(--text2);line-height:1.8">
              <strong style="color:var(--text)">Accept</strong> â€” Business impact acceptable, documented<br>
              <strong style="color:var(--text)">Eliminate</strong> â€” Remove vulnerable component<br>
              <strong style="color:var(--text)">Mitigate</strong> â€” Add controls to reduce risk<br>
              <strong style="color:var(--text)">Transfer</strong> â€” Insurer or customer bears risk
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- â”€â”€â”€ STEP 4: ASSESS â”€â”€â”€ -->
    <div class="step-panel" id="panel4">
      <div class="assess-layout">
        <div class="assess-main">
          <div style="font-size:14px;font-weight:800;margin-bottom:14px">Step 4 â€” Assess Your Work</div>
          <div class="assess-grid" id="assessGrid">
            <div class="assess-card">
              <div class="assess-num" id="aN" style="color:var(--info)">0</div>
              <div class="assess-lbl">DFD Components</div>
            </div>
            <div class="assess-card">
              <div class="assess-num" id="aE" style="color:var(--accent)">0</div>
              <div class="assess-lbl">Data Flows</div>
            </div>
            <div class="assess-card">
              <div class="assess-num" id="aT" style="color:var(--crit)">0</div>
              <div class="assess-lbl">Threats Found</div>
            </div>
            <div class="assess-card">
              <div class="assess-num" id="aC" style="color:var(--crit)">0</div>
              <div class="assess-lbl">Critical</div>
            </div>
            <div class="assess-card">
              <div class="assess-num" id="aH" style="color:var(--high)">0</div>
              <div class="assess-lbl">High</div>
            </div>
            <div class="assess-card">
              <div class="assess-num" id="aM" style="color:var(--med)">0</div>
              <div class="assess-lbl">Medium</div>
            </div>
            <div class="assess-card">
              <div class="assess-num" id="aMit" style="color:var(--accent)">0</div>
              <div class="assess-lbl">Mitigated</div>
            </div>
            <div class="assess-card">
              <div class="assess-num" id="aPar" style="color:var(--med)">0</div>
              <div class="assess-lbl">Partial</div>
            </div>
            <div class="assess-card">
              <div class="assess-num" id="aUnm" style="color:var(--crit)">0</div>
              <div class="assess-lbl">Unmitigated</div>
            </div>
          </div>
          <div style="font-size:13px;font-weight:800;margin-bottom:10px">âœ… OWASP Completeness Checklist</div>
          <div class="chk-item">
            <div class="chk-ico">ğŸ—</div>
            <div>
              <div class="chk-text">Data Flow Diagram</div>
              <div class="chk-sub">Components and data flows drawn on canvas</div>
            </div>
            <div class="chk-status chk-fail" id="kDfd">âœ— Missing</div>
          </div>
          <div class="chk-item">
            <div class="chk-ico">ğŸ“‹</div>
            <div>
              <div class="chk-text">Project Scoped</div>
              <div class="chk-sub">App name, description, owner defined</div>
            </div>
            <div class="chk-status chk-fail" id="kScope">âœ— Missing</div>
          </div>
          <div class="chk-item">
            <div class="chk-ico">ğŸšª</div>
            <div>
              <div class="chk-text">Entry / Exit Points</div>
              <div class="chk-sub">Attack surface documented</div>
            </div>
            <div class="chk-status chk-fail" id="kEntry">âœ— Missing</div>
          </div>
          <div class="chk-item">
            <div class="chk-ico">ğŸ”‘</div>
            <div>
              <div class="chk-text">Trust Levels Defined</div>
              <div class="chk-sub">Access rights for external entities specified</div>
            </div>
            <div class="chk-status chk-fail" id="kTrust">âœ— Missing</div>
          </div>
          <div class="chk-item">
            <div class="chk-ico">ğŸ’</div>
            <div>
              <div class="chk-text">Assets Identified</div>
              <div class="chk-sub">Physical and abstract assets inventoried</div>
            </div>
            <div class="chk-status chk-fail" id="kAssets">âœ— Missing</div>
          </div>
          <div class="chk-item">
            <div class="chk-ico">âš ï¸</div>
            <div>
              <div class="chk-text">Threat List</div>
              <div class="chk-sub">STRIDE threats identified and documented</div>
            </div>
            <div class="chk-status chk-fail" id="kThreats">âœ— Missing</div>
          </div>
          <div class="chk-item">
            <div class="chk-ico">ğŸ›¡</div>
            <div>
              <div class="chk-text">Countermeasure Register</div>
              <div class="chk-sub">All threats have a mitigation response assigned</div>
            </div>
            <div class="chk-status chk-fail" id="kControls">âœ— Missing</div>
          </div>
          <div class="chk-item">
            <div class="chk-ico">ğŸ“Š</div>
            <div>
              <div class="chk-text">Risk Ranked</div>
              <div class="chk-sub">Threats ranked by likelihood Ã— impact (qualitative)</div>
            </div>
            <div class="chk-status chk-fail" id="kRisk">âœ— Missing</div>
          </div>
          <div style="display:flex;gap:10px;margin-top:14px">
            <button class="btn btn-primary" id="refreshAssessBtn">â†» Refresh</button>
            <button class="btn btn-primary" style="background:#1d4ed8;flex:1" id="openExecBtn">ğŸ“‹ Generate Executive
              Summary</button>
            <button class="btn btn-ghost" id="exportBtn2">â¬‡ Export Full Report</button>
          </div>
        </div>
      </div>
    </div>

    <!-- â”€â”€â”€ EXECUTIVE SUMMARY MODAL â”€â”€â”€ -->
    <div class="overlay" id="execModal">
      <div class="exec-modal" id="execModalContent">
        <!-- content injected by openExecSummary() -->
      </div>
    </div>

    <!-- â”€â”€â”€ STEP 5: CLOUD SYNC â”€â”€â”€ -->
    <!-- Bug fix: panel5 was missing â€” goStep(5) would blank the entire app since -->
    <!-- querySelectorAll('.step-panel')[4] doesn't exist. Panel added as placeholder. -->
    <div class="step-panel" id="panel5">
      <div
        style="flex:1;overflow-y:auto;padding:28px;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;gap:0">
        <div style="max-width:520px;width:100%">
          <div style="font-size:14px;font-weight:800;margin-bottom:6px">â‘¤ Cloud Sync</div>
          <div style="font-size:12px;color:var(--text2);margin-bottom:24px">Share and sync your threat model with your
            team.</div>

          <!-- Coming soon notice -->
          <div
            style="background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:20px 22px;margin-bottom:18px">
            <div style="font-size:13px;font-weight:800;margin-bottom:8px;display:flex;align-items:center;gap:8px">
              <span
                style="background:rgba(245,158,11,.15);color:var(--accent);font-size:10px;padding:2px 7px;border-radius:4px;font-weight:700;letter-spacing:.5px">COMING
                SOON</span>
              Real-time collaboration
            </div>
            <div style="font-size:12px;color:var(--text2);line-height:1.7">
              Cloud sync will let your team co-edit threat models in real time, leave review comments, and track model
              version history â€” without leaving ThreatCanvas.
            </div>
          </div>

          <!-- Available now: local save/load -->
          <div
            style="font-size:12px;font-weight:700;color:var(--text2);letter-spacing:.5px;text-transform:uppercase;margin-bottom:10px">
            Available Now â€” Local File Sync</div>
          <div
            style="background:var(--surface);border:1px solid var(--border);border-radius:10px;overflow:hidden;margin-bottom:18px">
            <div style="padding:14px 16px;border-bottom:1px solid var(--border)">
              <div style="font-size:12px;font-weight:700;margin-bottom:4px">ğŸ’¾ Save Project</div>
              <div style="font-size:11px;color:var(--text2);margin-bottom:10px">Download your complete threat model as a
                portable JSON file. Share it with teammates who can load it directly into ThreatCanvas.</div>
              <button class="btn btn-primary btn-sm">â¬‡ Download .json</button>
            </div>
            <div style="padding:14px 16px">
              <div style="font-size:12px;font-weight:700;margin-bottom:4px">ğŸ“‚ Load Project</div>
              <div style="font-size:11px;color:var(--text2);margin-bottom:10px">Open a previously saved ThreatCanvas
                JSON file. Your scope, DFD topology, and countermeasure decisions will be restored. Threats are always
                recomputed fresh.</div>
              <label class="btn btn-ghost btn-sm" style="cursor:pointer">
                â¬† Open .json
                <input type="file" accept=".json" style="display:none">
              </label>
            </div>
          </div>

          <!-- Export -->
          <div
            style="font-size:12px;font-weight:700;color:var(--text2);letter-spacing:.5px;text-transform:uppercase;margin-bottom:10px">
            Export</div>
          <div style="background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:14px 16px">
            <div style="font-size:12px;font-weight:700;margin-bottom:4px">ğŸ“‹ Export Threat Report</div>
            <div style="font-size:11px;color:var(--text2);margin-bottom:10px">Generate a standalone HTML report
              containing your full threat register, risk ratings, and countermeasure decisions â€” ready to share with
              stakeholders.</div>
            <button class="btn btn-ghost btn-sm">â¬‡ Export HTML Report</button>
          </div>
        </div>
      </div>
    </div>

  </div><!-- /main -->

  <!-- SIM BAR -->
  <div class="sim-bar" id="simBar" style="display:none">
    <div class="sim-dot" id="simDot"></div>
    <span id="simLbl" style="color:var(--text3)">IDLE</span>
    <div class="tb-sep"></div>
    <span>Packets: <span class="sv" id="pktCnt">0</span></span>
    <span>Attacks triggered: <span class="sv" style="color:var(--crit)" id="trigCnt">0</span></span>
    <div style="margin-left:auto;font-size:11px;color:var(--text2)">DEL = delete selected node â€¢ A = analyze â€¢ Click
      edge label = edit/delete connection</div>
  </div>
  <div class="toolbar" id="mainToolbar">
    <span>Step 1: Scope â†’ Step 2: DFD + Threats â†’ Step 3: Countermeasures â†’ Step 4: Assess</span>
    <div class="tb-sep"></div>
    <span id="statusBar" style="color:var(--text3)">No analysis run yet</span>
  </div>

  <!-- MODAL -->
  <div class="overlay" id="connModal">
    <div class="modal">
      <div class="modal-title">ğŸ”— Configure Data Flow</div>
      <div class="frow">
        <div class="fg"><label class="lbl">Protocol</label>
          <select class="inp" id="cp">
            <option>HTTPS</option>
            <option>HTTP</option>
            <option>TCP</option>
            <option>UDP</option>
            <option>gRPC</option>
            <option>WebSocket</option>
            <option>AMQP</option>
            <option>SQL</option>
            <option>Redis</option>
            <option>S3</option>
          </select>
        </div>
        <div class="fg"><label class="lbl">Data Classification</label>
          <select class="inp" id="cd">
            <option>Public</option>
            <option>Internal</option>
            <option>Confidential</option>
            <option>Restricted</option>
            <option>PII</option>
            <option>PHI</option>
            <option>PCI</option>
          </select>
        </div>
      </div>
      <div class="frow">
        <div class="fg"><label class="lbl">Authentication</label>
          <select class="inp" id="ca">
            <option>None</option>
            <option>API Key</option>
            <option>JWT</option>
            <option>OAuth2</option>
            <option>mTLS</option>
            <option>IAM Role</option>
            <option>Basic Auth</option>
          </select>
        </div>
        <div class="fg"><label class="lbl">Encryption</label>
          <select class="inp" id="ce">
            <option>TLS 1.3</option>
            <option>TLS 1.2 (strong)</option>
            <option>TLS 1.2 (weak ciphers)</option>
            <option>TLS 1.0/1.1</option>
            <option>None</option>
          </select>
        </div>
      </div>
      <div class="frow">
        <div class="fg"><label class="lbl">Credential Scope</label>
          <select class="inp" id="ccs" title="Who owns the credential for this connection?">
            <option value="shared">Shared â€” any upstream node has it</option>
            <option value="service-bound">Service-Bound â€” source service only</option>
            <option value="vault">Vault-Managed â€” requires secret retrieval</option>
          </select>
        </div>
        <div class="fg"><label class="lbl">Network Route</label>
          <select class="inp" id="cnr" title="Does a network-layer route exist between these zones?">
            <option value="direct">Direct Route</option>
            <option value="vpc-peering">VPC Peering</option>
            <option value="none">No Route (zone-isolated)</option>
          </select>
        </div>
      </div>
      <div class="fg"><label class="lbl">Trust Boundary Crossed?</label>
        <select class="inp" id="ctb">
          <option>No</option>
          <option>Yes â€” Internet to DMZ</option>
          <option>Yes â€” DMZ to Internal</option>
          <option>Yes â€” Internal to Restricted</option>
        </select>
      </div>
      <div class="modal-actions">
        <button class="btn btn-ghost" id="connCancel">Cancel</button>
        <button class="btn btn-primary" id="connOk">Add Data Flow</button>
      </div>
    </div>
  </div>

  <!-- â”€â”€â”€ RULE EDITOR MODAL â”€â”€â”€ -->
  <div class="overlay" id="ruleEditorModal">
    <div class="re-modal">
      <div class="re-modal-header">
        <div>
          <div class="re-modal-title">âš™ Custom Rule Engine</div>
          <div class="re-modal-subtitle">Create, manage, and import domain-specific threat rules</div>
        </div>
        <button class="exec-close" id="closeRulesBtn">âœ•</button>
      </div>
      <div id="ruleEditorContent"></div>
    </div>
  </div>

  <script type="module" src="src/main.js"></script>
</body>

</html>