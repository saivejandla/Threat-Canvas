<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ThreatCanvas ‚Äî OWASP Threat Modeler</title>
    <link rel="stylesheet" href="src/ui/main.css">
</head>

<body>

    <header>
        <div class="logo">
            <div class="logo-icon">üõ°</div>Threat<span>Canvas</span>
        </div>
        <div class="step-tabs">
            <div class="step-tab active" id="stab1"><span class="step-num">1</span> Scope</div>
            <div class="step-tab" id="stab2"><span class="step-num">2</span> Threats / DFD</div>
            <div class="step-tab" id="stab3"><span class="step-num">3</span> Countermeasures</div>
            <div class="step-tab" id="stab4"><span class="step-num">4</span> Assess</div>
            <div class="step-tab" id="stab5"><span class="step-num">5</span> Cloud Sync</div>
            <div class="step-tab" id="stab6"><span class="step-num">6</span> Rules Engine</div>
        </div>
        <div class="hdr-actions">
            <button class="btn btn-ghost btn-sm" id="btnLoadExample">Load Example</button>
            <div style="width:1px;height:16px;background:var(--border)"></div>
            <button class="btn btn-save btn-sm" id="btnSaveProject" title="Download full project as JSON">üíæ Save
                Project</button>
            <button class="btn btn-ghost btn-sm" id="btnLoadProjectTrigger" title="Restore project from JSON">üìÇ Load
                Project</button>
            <input type="file" id="loadFileInput" accept=".json,application/json" style="display:none">
            <div style="width:1px;height:16px;background:var(--border)"></div>
            <button class="btn btn-primary btn-sm" id="btnExportReportHdr">‚¨á Export Report</button>
        </div>
    </header>

    <div class="main">

        <!-- ‚îÄ‚îÄ‚îÄ STEP 1: SCOPE ‚îÄ‚îÄ‚îÄ -->
        <div class="step-panel active" id="panel1">
            <div class="scope-layout">
                <div class="scope-sidebar">
                    <div
                        style="padding:11px 14px;border-bottom:1px solid var(--border);font-size:10px;font-weight:800;letter-spacing:1.5px;color:var(--text3)">
                        STEP 1 ‚Äî SCOPE</div>
                    <div class="scope-nav-item anav" data-sec="info">
                        <div class="scope-nav-num">1</div>Project Info
                    </div>
                    <div class="scope-nav-item" data-sec="deps">
                        <div class="scope-nav-num">2</div>External Dependencies
                    </div>
                    <div class="scope-nav-item" data-sec="entry">
                        <div class="scope-nav-num">3</div>Entry Points
                    </div>
                    <div class="scope-nav-item" data-sec="exit">
                        <div class="scope-nav-num">4</div>Exit Points
                    </div>
                    <div class="scope-nav-item" data-sec="assets">
                        <div class="scope-nav-num">5</div>Assets
                    </div>
                    <div class="scope-nav-item" data-sec="trust">
                        <div class="scope-nav-num">6</div>Trust Levels
                    </div>
                    <div style="padding:12px;margin-top:auto;border-top:1px solid var(--border);">
                        <button class="btn btn-primary" style="width:100%" id="btnNextToDfd">Next: Build DFD ‚Üí</button>
                    </div>
                </div>
                <div class="scope-main">
                    <!-- Project Info -->
                    <div class="scope-section asec" id="sec-info">
                        <div class="sec-card">
                            <div class="sec-hdr">
                                <div class="sec-title">üìã Threat Model Information</div>
                            </div>
                            <div class="sec-body">
                                <div class="frow">
                                    <div class="fg"><label class="lbl">Application Name</label><input class="inp"
                                            id="appName" placeholder="e.g. College Library Website"></div>
                                    <div class="fg"><label class="lbl">Version</label><input class="inp" id="appVersion"
                                            placeholder="e.g. 1.0"></div>
                                </div>
                                <div class="fg"><label class="lbl">Description</label><textarea class="inp" id="appDesc"
                                        placeholder="High-level description of the application and its purpose..."></textarea>
                                </div>
                                <div class="frow">
                                    <div class="fg"><label class="lbl">Document Owner</label><input class="inp"
                                            id="docOwner" placeholder="e.g. David Lowry"></div>
                                    <div class="fg"><label class="lbl">Participants</label><input class="inp"
                                            id="docParticipants" placeholder="e.g. David Rook"></div>
                                </div>
                                <div class="frow">
                                    <div class="fg"><label class="lbl">Reviewer</label><input class="inp"
                                            id="docReviewer" placeholder="e.g. Eoin Keary"></div>
                                    <div class="fg"><label class="lbl">Date</label><input class="inp" id="docDate"
                                            type="date"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- External Dependencies -->
                    <div class="scope-section" id="sec-deps">
                        <div class="sec-card">
                            <div class="sec-hdr">
                                <div class="sec-title">üîó External Dependencies</div><span
                                    style="font-size:11px;color:var(--text2)">Items outside codebase that may pose
                                    threats</span>
                            </div>
                            <div class="sec-body">
                                <table class="dtable">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Description</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody id="depsTbody"></tbody>
                                </table>
                                <button class="add-btn" data-add="deps">+ Add External Dependency</button>
                            </div>
                        </div>
                    </div>
                    <!-- Entry Points -->
                    <div class="scope-section" id="sec-entry">
                        <div class="sec-card">
                            <div class="sec-hdr">
                                <div class="sec-title">üö™ Entry Points</div><span
                                    style="font-size:11px;color:var(--text2)">Where attackers interact with the
                                    system</span>
                            </div>
                            <div class="sec-body">
                                <table class="dtable">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Description</th>
                                            <th>Trust Levels</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody id="entryTbody"></tbody>
                                </table>
                                <button class="add-btn" data-add="entry">+ Add Entry Point</button>
                            </div>
                        </div>
                    </div>
                    <!-- Exit Points -->
                    <div class="scope-section" id="sec-exit">
                        <div class="sec-card">
                            <div class="sec-hdr">
                                <div class="sec-title">üö™ Exit Points</div><span
                                    style="font-size:11px;color:var(--text2)">Where data leaves the system (XSS, info
                                    disclosure)</span>
                            </div>
                            <div class="sec-body">
                                <table class="dtable">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Description</th>
                                            <th>Risk</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody id="exitTbody"></tbody>
                                </table>
                                <button class="add-btn" data-add="exit">+ Add Exit Point</button>
                            </div>
                        </div>
                    </div>
                    <!-- Assets -->
                    <div class="scope-section" id="sec-assets">
                        <div class="sec-card">
                            <div class="sec-hdr">
                                <div class="sec-title">üíé Assets</div><span
                                    style="font-size:11px;color:var(--text2)">Physical and abstract items worth
                                    protecting</span>
                            </div>
                            <div class="sec-body">
                                <table class="dtable">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Description</th>
                                            <th>Required Trust Levels</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody id="assetsTbody"></tbody>
                                </table>
                                <button class="add-btn" data-add="assets">+ Add Asset</button>
                            </div>
                        </div>
                    </div>
                    <!-- Trust Levels -->
                    <div class="scope-section" id="sec-trust">
                        <div class="sec-card">
                            <div class="sec-hdr">
                                <div class="sec-title">üîë Trust Levels</div><span
                                    style="font-size:11px;color:var(--text2)">Access rights granted to external
                                    entities</span>
                            </div>
                            <div class="sec-body">
                                <table class="dtable">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Description</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody id="trustTbody"></tbody>
                                </table>
                                <button class="add-btn" data-add="trust">+ Add Trust Level</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ‚îÄ STEP 2: THREATS / DFD ‚îÄ‚îÄ‚îÄ -->
        <div class="step-panel" id="panel2">
            <div class="threats-layout">
                <div class="palette">
                    <div class="pal-sec">
                        <div class="pal-lbl">External</div>
                        <div class="pal-item" draggable="true" data-type="internet">
                            <div class="pal-ico" style="background:rgba(255,107,107,.15)">üåê</div>Internet
                        </div>
                        <div class="pal-item" draggable="true" data-type="user">
                            <div class="pal-ico" style="background:rgba(77,157,224,.15)">üë§</div>User
                        </div>
                        <div class="pal-item" draggable="true" data-type="attacker">
                            <div class="pal-ico" style="background:rgba(255,68,68,.15)">‚ò†Ô∏è</div>Attacker
                        </div>
                    </div>
                    <div class="pal-sec">
                        <div class="pal-lbl">Network</div>
                        <div class="pal-item" draggable="true" data-type="firewall">
                            <div class="pal-ico" style="background:rgba(255,140,0,.15)">üî•</div>Firewall
                        </div>
                        <div class="pal-item" draggable="true" data-type="loadbalancer">
                            <div class="pal-ico" style="background:rgba(245,158,11,.15)">‚öñÔ∏è</div>Load Balancer
                        </div>
                        <div class="pal-item" draggable="true" data-type="vpn">
                            <div class="pal-ico" style="background:rgba(77,157,224,.15)">üîí</div>VPN
                        </div>
                        <div class="pal-item" draggable="true" data-type="cdn">
                            <div class="pal-ico" style="background:rgba(245,158,11,.15)">‚òÅÔ∏è</div>CDN
                        </div>
                    </div>
                    <div class="pal-sec">
                        <div class="pal-lbl">Compute</div>
                        <div class="pal-item" draggable="true" data-type="webserver">
                            <div class="pal-ico" style="background:rgba(0,102,255,.15)">üñ•</div>Web Server
                        </div>
                        <div class="pal-item" draggable="true" data-type="api">
                            <div class="pal-ico" style="background:rgba(245,158,11,.15)">‚ö°</div>API Server
                        </div>
                        <div class="pal-item" draggable="true" data-type="microservice">
                            <div class="pal-ico" style="background:rgba(77,157,224,.15)">üîß</div>Microservice
                        </div>
                        <div class="pal-item" draggable="true" data-type="lambda">
                            <div class="pal-ico" style="background:rgba(255,140,0,.15)">Œª</div>Serverless
                        </div>
                    </div>
                    <div class="pal-sec">
                        <div class="pal-lbl">Data</div>
                        <div class="pal-item" draggable="true" data-type="database">
                            <div class="pal-ico" style="background:rgba(255,107,107,.15)">üóÑ</div>Database
                        </div>
                        <div class="pal-item" draggable="true" data-type="cache">
                            <div class="pal-ico" style="background:rgba(255,217,61,.15)">‚ö°</div>Cache
                        </div>
                        <div class="pal-item" draggable="true" data-type="storage">
                            <div class="pal-ico" style="background:rgba(245,158,11,.15)">üì¶</div>Storage
                        </div>
                        <div class="pal-item" draggable="true" data-type="messagequeue">
                            <div class="pal-ico" style="background:rgba(77,157,224,.15)">üì®</div>Msg Queue
                        </div>
                    </div>
                    <div class="pal-sec">
                        <div class="pal-lbl">Security</div>
                        <div class="pal-item" draggable="true" data-type="waf">
                            <div class="pal-ico" style="background:rgba(255,140,0,.15)">üõ°</div>WAF
                        </div>
                        <div class="pal-item" draggable="true" data-type="idp">
                            <div class="pal-ico" style="background:rgba(245,158,11,.15)">üîë</div>Identity Provider
                        </div>
                        <div class="pal-item" draggable="true" data-type="siem">
                            <div class="pal-ico" style="background:rgba(255,68,68,.15)">üëÅ</div>SIEM
                        </div>
                    </div>
                    <div class="pal-sec">
                        <div class="pal-lbl">Grouping</div>
                        <div class="pal-item" draggable="true" data-type="boundary">
                            <div class="pal-ico" style="background:var(--bg3); border:1px dashed #aaa">üî≥</div>Trust
                            Boundary
                        </div>
                    </div>
                </div>
                <div class="canvas-wrap" id="canvasWrap">
                    <!-- #viewport is the single transform target for zoom + pan.
         Both the SVG edge layer and the node layer live inside it
         so all coordinates stay in the same space regardless of zoom. -->
                    <div id="viewport">
                        <svg id="svgLayer"></svg>
                        <div id="canvas"></div>
                    </div>

                    <!-- Empty-hint lives outside #viewport so it always centres
         in the visible canvas-wrap area, not the 4000px virtual canvas -->
                    <div class="empty-hint" id="emptyHint">
                        <div style="font-size:42px;margin-bottom:14px;opacity:.2">üèó</div>
                        <h3>Build your Data Flow Diagram</h3>
                        <p>Drag components from the left ‚Ä¢ Click ports to connect ‚Ä¢ Right-click an edge to edit/delete ‚Ä¢
                            Press <kbd
                                style="background:var(--s2);border:1px solid var(--border);border-radius:3px;padding:1px 5px;font-size:11px">A</kbd>
                            to analyze</p>
                        <button class="btn btn-primary" style="margin-top:16px;font-size:12px"
                            id="btnEmptyHintExample">‚ñ∂ Load Example Architecture</button>
                    </div>

                    <!-- Zoom controls ‚Äî bottom-right corner, always on top -->
                    <div class="zoom-bar" id="zoomBar">
                        <button class="zoom-btn" id="btnZoomOut" title="Zoom out (-)">‚àí</button>
                        <span class="zoom-pct" id="zoomPct">100%</span>
                        <button class="zoom-btn" id="btnZoomIn" title="Zoom in (+)">+</button>
                        <div class="zoom-sep"></div>
                        <button class="zoom-btn" id="btnZoomFit" title="Fit all nodes in view">‚ä°</button>
                        <button class="zoom-btn" id="btnZoomReset" title="Reset to 100%">1:1</button>
                    </div>
                </div>
                <div class="rpanel" id="rpanel">
                    <!-- ‚îÄ‚îÄ Mode toggle ‚îÄ‚îÄ -->
                    <div style="display:flex;gap:6px;margin-bottom:12px">
                        <button class="btn-mode active" id="modeAnalyze" data-mode="analyze" style="flex:1">üîç
                            Analyze</button>
                        <button class="btn-mode" id="modeBlast" data-mode="blast" style="flex:1">üí• Blast
                            Radius</button>
                    </div>

                    <!-- ‚îÄ‚îÄ Component Threat Profile (shown when node selected) ‚îÄ‚îÄ -->
                    <div id="ctpSection" style="display:none"></div>

                    <!-- ‚îÄ‚îÄ Edge Editor (shown when edge clicked) ‚îÄ‚îÄ -->
                    <div id="edgeEditorSection" style="display:none"></div>

                    <!-- ‚îÄ‚îÄ Blast radius info ‚îÄ‚îÄ -->
                    <div id="blastInfo" style="display:none">
                        <div class="blast-bar">
                            <span class="blast-label">üí• BLAST RADIUS</span>
                            <span id="blastCount" style="color:var(--text2)">Click a node to simulate compromise</span>
                        </div>
                    </div>

                    <!-- ‚îÄ‚îÄ Analyze mode content ‚îÄ‚îÄ -->
                    <div id="analyzeContent">
                        <!-- Mode tabs: Threats vs Attack Paths -->
                        <div class="mode-bar">
                            <div class="mode-tab active" id="rpTab-threats" data-rptab="threats">üîç Threats</div>
                            <div class="mode-tab" id="rpTab-paths" data-rptab="paths">‚öîÔ∏è Attack Paths <span
                                    id="apTabBadge"
                                    style="background:rgba(239,68,68,.2);color:#ef4444;border-radius:10px;padding:0 5px;font-size:9px;font-family:'JetBrains Mono',monospace">0</span>
                            </div>
                        </div>

                        <!-- Threats sub-panel -->
                        <div id="rpPanel-threats">
                            <div id="detectedThreats" style="margin-bottom:10px">
                                <div style="text-align:center;color:var(--text3);padding:24px 0;font-size:12px">Build
                                    DFD then press Analyze</div>
                            </div>
                        </div>

                        <!-- Attack Paths sub-panel -->
                        <div id="rpPanel-paths" style="display:none">
                            <div id="attackPathsContainer">
                                <div style="text-align:center;color:var(--text3);padding:24px 0;font-size:12px">Run
                                    analysis to detect attack paths</div>
                            </div>
                            <button class="btn btn-ghost" style="width:100%;font-size:11px;margin-top:8px"
                                id="btnClearPaths">‚úï Clear Highlights</button>
                        </div>

                        <button class="btn btn-primary" style="width:100%;margin-bottom:7px;margin-top:6px"
                            id="btnRunAnalysis">‚ñ∂ Analyze Architecture</button>
                        <button class="btn btn-ghost" style="width:100%;font-size:11px;margin-bottom:14px"
                            id="btnClearCanvas">Clear Canvas</button>
                        <div class="rp-title">‚öîÔ∏è Attack Simulation</div>
                        <button class="btn btn-ghost" style="width:100%;font-size:11px;margin-bottom:7px"
                            id="simToggleBtn">‚ñ∂ Start Traffic Sim</button>
                        <div class="atk-btn" data-attack="sqli">üíâ SQL Injection</div>
                        <div class="atk-btn" data-attack="ddos">üí• DDoS Flood</div>
                        <div class="atk-btn" data-attack="lateral">‚ÜîÔ∏è Lateral Movement</div>
                        <div class="atk-btn" data-attack="exfil">üì§ Data Exfiltration</div>
                    </div>

                    <!-- ‚îÄ‚îÄ Blast mode content ‚îÄ‚îÄ -->
                    <div id="blastContent" style="display:none">
                        <div style="font-size:11px;color:var(--text2);line-height:1.8;margin-bottom:12px">
                            <strong style="color:var(--text)">Node colors:</strong><br>
                            <span style="color:#ef4444">‚ñ†</span> Source (compromised)<br>
                            <span style="color:#f97316">‚ñ†</span> Reachable (1 hop)<br>
                            <span style="color:#facc15">‚ñ†</span> Reachable (2+ hops)<br>
                            <span style="color:#a78bfa">‚ñ†</span> Reachable via priv-esc<br>
                            <span style="color:var(--text3)">‚ñ†</span> Blocked / unreachable<br><br>
                            <strong style="color:var(--text)">Edge colors:</strong><br>
                            <span style="color:#ef4444">‚Äî‚Äî</span> Traversed blast path<br>
                            <span style="color:#34d399">- -</span> üõ° Blocked by auth+TLS<br>
                            <span style="color:#34d399">- -</span> üîë Credential not scoped<br>
                            <span style="color:#374151">¬∑¬∑</span> üöß No network route<br>
                            <span style="color:#a78bfa">‚Äî‚Äî</span> ‚¨ÜÔ∏è Privilege escalation<br><br>
                            <strong style="color:var(--text)">Detection badges:</strong><br>
                            <span
                                style="background:#ef4444;color:#fff;padding:1px 4px;border-radius:2px;font-size:9px">low%</span>
                            Low detection risk<br>
                            <span
                                style="background:#f97316;color:#fff;padding:1px 4px;border-radius:2px;font-size:9px">med%</span>
                            Moderate risk<br>
                            <span
                                style="background:#34d399;color:#000;padding:1px 4px;border-radius:2px;font-size:9px">high%</span>
                            Likely detected<br><br>
                            <span style="color:var(--text3);font-size:10px;line-height:1.6">
                                <strong style="color:var(--text2)">6 factors modeled:</strong><br>
                                1. Auth strength + TLS version<br>
                                2. Credential scope (shared vs vault)<br>
                                3. Network zone + route existence<br>
                                4. Compromise impact level<br>
                                5. Detection probability (SIEM/WAF)<br>
                                6. IAM privilege escalation paths
                            </span>
                        </div>
                        <button class="btn btn-ghost" style="width:100%;font-size:11px" id="btnClearBlast">‚úï Clear Blast
                            Radius</button>

                        <!-- ‚ö†Ô∏è Professional disclaimer ‚Äî detection % are model estimates, not measured values -->
                        <div class="blast-disclaimer">
                            <div class="blast-disclaimer-icon">‚ö†Ô∏è</div>
                            <div class="blast-disclaimer-text">
                                <strong>Design-Time Model Only</strong><br>
                                Detection probabilities and reachability scores model <em>theoretical</em> attack paths
                                based on your architecture configuration. They are <strong>not</strong> measured against
                                live infrastructure.<br><br>
                                This is not a substitute for penetration testing or attack simulation tools (e.g. MITRE
                                ATT&CK, Atomic Red Team, or professional red-team engagements).
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ‚îÄ STEP 3: COUNTERMEASURES ‚îÄ‚îÄ‚îÄ -->
        <div class="step-panel" id="panel3">
            <div class="cm-layout">
                <div class="cm-main">
                    <div style="font-size:14px;font-weight:800;margin-bottom:14px">STRIDE Threat Categories <span
                            style="font-size:11px;font-weight:400;color:var(--text2)">‚Äî Click to filter</span></div>
                    <div class="stride-grid" id="strideGrid">
                        <div class="stride-card" data-stride="S">
                            <div class="stride-ico">üé≠</div>
                            <div class="stride-name">Spoofing</div>
                            <div class="stride-desc">Identity / credential abuse</div>
                            <div class="stride-cnt" id="cS" style="color:#9b59b6">0</div>
                        </div>
                        <div class="stride-card" data-stride="T">
                            <div class="stride-ico">‚úèÔ∏è</div>
                            <div class="stride-name">Tampering</div>
                            <div class="stride-desc">Malicious data modification</div>
                            <div class="stride-cnt" id="cT" style="color:#e67e22">0</div>
                        </div>
                        <div class="stride-card" data-stride="R">
                            <div class="stride-ico">üö´</div>
                            <div class="stride-name">Repudiation</div>
                            <div class="stride-desc">Untraceable operations</div>
                            <div class="stride-cnt" id="cR" style="color:#3498db">0</div>
                        </div>
                        <div class="stride-card" data-stride="I">
                            <div class="stride-ico">üëÅ</div>
                            <div class="stride-name">Info Disclosure</div>
                            <div class="stride-desc">Unauthorized data access</div>
                            <div class="stride-cnt" id="cI" style="color:#e74c3c">0</div>
                        </div>
                        <div class="stride-card" data-stride="D">
                            <div class="stride-ico">üí•</div>
                            <div class="stride-name">Denial of Service</div>
                            <div class="stride-desc">Availability disruption</div>
                            <div class="stride-cnt" id="cD" style="color:#2ecc71">0</div>
                        </div>
                        <div class="stride-card" data-stride="E">
                            <div class="stride-ico">‚¨ÜÔ∏è</div>
                            <div class="stride-name">Elevation of Privilege</div>
                            <div class="stride-desc">Unauthorized privilege gain</div>
                            <div class="stride-cnt" id="cE" style="color:#ff6b6b">0</div>
                        </div>
                    </div>
                    <div class="sec-card">
                        <div class="sec-card-hdr">
                            <div class="sec-card-title">üìã Threat Countermeasure Register</div><span
                                style="font-size:11px;color:var(--text2)">Set Accept / Eliminate / Mitigate / Transfer
                                per threat</span>
                        </div>
                        <table class="dtable" id="cmTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Threat</th>
                                    <th>STRIDE</th>
                                    <th>Severity</th>
                                    <th>Likelihood</th>
                                    <th>Impact</th>
                                    <th>Risk</th>
                                    <th>Response</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="cmTbody">
                                <tr>
                                    <td colspan="9" style="text-align:center;color:var(--text3);padding:28px">Run
                                        analysis in Step 2 first</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="cm-sidebar">
                    <div class="rp-title">üìñ STRIDE ‚Üí Controls</div>
                    <div style="font-size:11px;line-height:1.7;color:var(--text2)">
                        <div style="margin-bottom:11px"><strong style="color:#9b59b6">üé≠ Spoofing ‚Üí
                                Authentication</strong><br>‚Ä¢ Strong authentication<br>‚Ä¢ Protect secret data<br>‚Ä¢ Don't
                            store secrets</div>
                        <div style="margin-bottom:11px"><strong style="color:#e67e22">‚úèÔ∏è Tampering ‚Üí
                                Integrity</strong><br>‚Ä¢ Authorization<br>‚Ä¢ Hashes / MACs<br>‚Ä¢ Digital signatures<br>‚Ä¢
                            Tamper-resistant protocols</div>
                        <div style="margin-bottom:11px"><strong style="color:#3498db">üö´ Repudiation ‚Üí
                                Non-Repudiation</strong><br>‚Ä¢ Digital signatures<br>‚Ä¢ Timestamps<br>‚Ä¢ Audit trails</div>
                        <div style="margin-bottom:11px"><strong style="color:#e74c3c">üëÅ Info Disclosure ‚Üí
                                Confidentiality</strong><br>‚Ä¢ Authorization<br>‚Ä¢ Privacy-enhanced protocols<br>‚Ä¢
                            Encryption<br>‚Ä¢ Don't store secrets</div>
                        <div style="margin-bottom:11px"><strong style="color:#2ecc71">üí• DoS ‚Üí
                                Availability</strong><br>‚Ä¢ Authentication + AuthZ<br>‚Ä¢ Filtering & throttling<br>‚Ä¢
                            Quality of service</div>
                        <div style="margin-bottom:11px"><strong style="color:#ff6b6b">‚¨ÜÔ∏è EoP ‚Üí
                                Authorization</strong><br>‚Ä¢ Least privilege<br>‚Ä¢ RBAC enforcement<br>‚Ä¢ Privilege
                            separation</div>
                    </div>
                    <div style="border-top:1px solid var(--border);padding-top:12px;margin-top:6px">
                        <div class="rp-title">üìä Qualitative Risk Model</div>
                        <div style="font-size:11px;color:var(--text2);line-height:1.7">
                            <span style="color:var(--crit)">Critical</span> = High √ó High<br>
                            <span style="color:var(--high)">High</span> = High √ó Med<br>
                            <span style="color:var(--med)">Medium</span> = Med √ó Med<br>
                            <span style="color:var(--low)">Low</span> = Low √ó Low
                        </div>
                    </div>
                    <div style="border-top:1px solid var(--border);padding-top:12px;margin-top:10px">
                        <div class="rp-title">üõ° Response Options</div>
                        <div style="font-size:11px;color:var(--text2);line-height:1.8">
                            <strong style="color:var(--text)">Accept</strong> ‚Äî Business impact acceptable,
                            documented<br>
                            <strong style="color:var(--text)">Eliminate</strong> ‚Äî Remove vulnerable component<br>
                            <strong style="color:var(--text)">Mitigate</strong> ‚Äî Add controls to reduce risk<br>
                            <strong style="color:var(--text)">Transfer</strong> ‚Äî Insurer or customer bears risk
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ‚îÄ STEP 4: ASSESS ‚îÄ‚îÄ‚îÄ -->
        <div class="step-panel" id="panel4">
            <div class="assess-layout">
                <div class="assess-main">
                    <div style="font-size:14px;font-weight:800;margin-bottom:14px">Step 4 ‚Äî Assess Your Work</div>
                    <div class="assess-grid" id="assessGrid">
                        <div class="assess-card">
                            <div class="assess-num" id="aN" style="color:var(--info)">0</div>
                            <div class="assess-lbl">DFD Components</div>
                        </div>
                        <div class="assess-card">
                            <div class="assess-num" id="aE" style="color:var(--accent)">0</div>
                            <div class="assess-lbl">Data Flows</div>
                        </div>
                        <div class="assess-card">
                            <div class="assess-num" id="aT" style="color:var(--crit)">0</div>
                            <div class="assess-lbl">Threats Found</div>
                        </div>
                        <div class="assess-card">
                            <div class="assess-num" id="aC" style="color:var(--crit)">0</div>
                            <div class="assess-lbl">Critical</div>
                        </div>
                        <div class="assess-card">
                            <div class="assess-num" id="aH" style="color:var(--high)">0</div>
                            <div class="assess-lbl">High</div>
                        </div>
                        <div class="assess-card">
                            <div class="assess-num" id="aM" style="color:var(--med)">0</div>
                            <div class="assess-lbl">Medium</div>
                        </div>
                        <div class="assess-card">
                            <div class="assess-num" id="aMit" style="color:var(--accent)">0</div>
                            <div class="assess-lbl">Mitigated</div>
                        </div>
                        <div class="assess-card">
                            <div class="assess-num" id="aPar" style="color:var(--med)">0</div>
                            <div class="assess-lbl">Partial</div>
                        </div>
                        <div class="assess-card">
                            <div class="assess-num" id="aUnm" style="color:var(--crit)">0</div>
                            <div class="assess-lbl">Unmitigated</div>
                        </div>
                    </div>
                    <div style="font-size:13px;font-weight:800;margin-bottom:10px">‚úÖ OWASP Completeness Checklist</div>
                    <div class="chk-item">
                        <div class="chk-ico">üèó</div>
                        <div>
                            <div class="chk-text">Data Flow Diagram</div>
                            <div class="chk-sub">Components and data flows drawn on canvas</div>
                        </div>
                        <div class="chk-status chk-fail" id="kDfd">‚úó Missing</div>
                    </div>
                    <div class="chk-item">
                        <div class="chk-ico">üìã</div>
                        <div>
                            <div class="chk-text">Project Scoped</div>
                            <div class="chk-sub">App name, description, owner defined</div>
                        </div>
                        <div class="chk-status chk-fail" id="kScope">‚úó Missing</div>
                    </div>
                    <div class="chk-item">
                        <div class="chk-ico">üö™</div>
                        <div>
                            <div class="chk-text">Entry / Exit Points</div>
                            <div class="chk-sub">Attack surface documented</div>
                        </div>
                        <div class="chk-status chk-fail" id="kEntry">‚úó Missing</div>
                    </div>
                    <div class="chk-item">
                        <div class="chk-ico">üîë</div>
                        <div>
                            <div class="chk-text">Trust Levels Defined</div>
                            <div class="chk-sub">Access rights for external entities specified</div>
                        </div>
                        <div class="chk-status chk-fail" id="kTrust">‚úó Missing</div>
                    </div>
                    <div class="chk-item">
                        <div class="chk-ico">üíé</div>
                        <div>
                            <div class="chk-text">Assets Identified</div>
                            <div class="chk-sub">Physical and abstract assets inventoried</div>
                        </div>
                        <div class="chk-status chk-fail" id="kAssets">‚úó Missing</div>
                    </div>
                    <div class="chk-item">
                        <div class="chk-ico">‚ö†Ô∏è</div>
                        <div>
                            <div class="chk-text">Threat List</div>
                            <div class="chk-sub">STRIDE threats identified and documented</div>
                        </div>
                        <div class="chk-status chk-fail" id="kThreats">‚úó Missing</div>
                    </div>
                    <div class="chk-item">
                        <div class="chk-ico">üõ°</div>
                        <div>
                            <div class="chk-text">Countermeasure Register</div>
                            <div class="chk-sub">All threats have a mitigation response assigned</div>
                        </div>
                        <div class="chk-status chk-fail" id="kControls">‚úó Missing</div>
                    </div>
                    <div class="chk-item">
                        <div class="chk-ico">üìä</div>
                        <div>
                            <div class="chk-text">Risk Ranked</div>
                            <div class="chk-sub">Threats ranked by likelihood √ó impact (qualitative)</div>
                        </div>
                        <div class="chk-status chk-fail" id="kRisk">‚úó Missing</div>
                    </div>
                    <div style="display:flex;gap:10px;margin-top:14px">
                        <button class="btn btn-primary" id="btnRefreshAssess">‚Üª Refresh</button>
                        <button class="btn btn-primary" id="btnOpenExec" style="background:#1d4ed8;flex:1">üìã Generate
                            Executive Summary</button>
                        <button class="btn btn-ghost" id="btnExportReportFtr">‚¨á Export Full Report</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ‚îÄ EXECUTIVE SUMMARY MODAL ‚îÄ‚îÄ‚îÄ -->
        <div class="overlay" id="execModal">
            <div class="exec-modal" id="execModalContent">
                <!-- content injected by openExecSummary() -->
            </div>
        </div>

        <div class="step-panel" id="panel5">
        </div>

        <!-- ‚îÄ‚îÄ‚îÄ STEP 6: RULES ENGINE ‚îÄ‚îÄ‚îÄ -->
        <div class="step-panel" id="panel6">
            <div class="scope-layout" style="padding:40px; justify-content:center; display:flex;">
                <div class="sec-card" style="max-width:800px; width:100%">
                    <div class="sec-hdr">
                        <div class="sec-title">‚öôÔ∏è Custom Rules Engine</div>
                        <span style="font-size:11px;color:var(--text2)">Programmatically inject specialized threat logic
                            into the assessment engine.</span>
                    </div>
                    <div class="sec-body">
                        <div style="margin-bottom:20px; font-size:13px; color:var(--text3); line-height:1.6">
                            By default, ThreatCanvas runs standard STRIDE heuristics to identify missing WAFs,
                            unencrypted database connections, and excessive trust boundary traversal.
                            <br><br>
                            You can override or extend this logic by uploading a JSON ruleset describing custom
                            architectures.
                        </div>
                        <div
                            style="padding:20px; background:var(--bg3); border:1px dashed var(--border); border-radius:8px; text-align:center;">
                            <button class="btn btn-primary" id="btnUploadRulesTrigger">üìÇ Upload Custom Rules
                                (JSON)</button>
                            <input type="file" id="rulesFileInput" accept=".json,application/json" style="display:none">
                            <div style="margin-top:10px; font-size:11px; color:var(--text2)">Expected format:
                                <code>{ rules: [...], componentThreats: {...} }</code>
                            </div>
                        </div>
                        <div style="margin-top:20px; display:flex; gap:10px;">
                            <button class="btn btn-ghost" id="btnClearRules">Reset to Standard OWASP Rules</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <script type="module" src="src/main.js"></script>
</body>

</html>